@model Cinema.Areas.Admin.Models.GheModel


<h1>Index</h1>
@{
    if (ViewContext.RouteData.Values["id"] != null)
    {
        <p><a asp-action="Index" asp-route-id="">Create New</a></p>
    }
}
<hr />
@*<form class="container" action="Index" method="post">*@
@*<div class="row">
            <div class="col-md-3">
                <select name="MaCum" asp-items="@(new SelectList(ViewBag.ListCumRap,"Id","TenCum"))">Chọn Cụm Rạp</select>
            </div>
            <div class="col-md-3">
                <select name="MaRap" asp-items="@(new SelectList(ViewBag.ListRap,"Id","TenRap"))">Chọn Rạp</select>
            </div>
            <div class="col-md-3">
                <select name="MaPhong" asp-items="@(new SelectList(ViewBag.ListPhong,"Id","TenPhong"))">Chọn Phòng</select>
            </div>
            <div class="col-md-3">
                <button asp-action="Index">Tiếp theo</button>
            </div>
        </div>
    </form>*@

<hr />
<partial name="Create" />
<hr />
<form class="container" action="Index" method="get">
    <div class="row">
        <div class="col-md-4">
            <input type="number" min="1" name="s_name" @(Context.Request.Query["s_name"]!=""?("value="+Context.Request.Query["s_name"]):null) placeholder="Nhập số ghế..." />
        </div>
        <div class="col-md-1">
            <button asp-action="Index">Tìm</button>
        </div>
    </div>
</form>
<hr />
<table class="table">
    <thead>
        <tr>
            <th>
                Ghế Số
            </th>
            <th>
                Trạng Thái
            </th>
            <th>
                Tên Hàng
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (GheModel item in ViewBag.ListGhe)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.TenGhe)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TrangThai)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Hang.TenHang)
                </td>
                <td>
                    <a class="btn btn-primary" asp-action="Index" asp-route-id="@item.Id">Edit</a>
                    <button class="btn btn-warning" name="btn_update_stt" data-id="@item.Id">
                        @{ if (item.TrangThai == true)
                            {
                                @:Khóa
                            }
                            else
                            {
                                @: Kích hoạt
                            }
                        }
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $('button[name=btn_update_stt]').click(function () {
            var id = $(this).attr('data-id');
            $.ajax({
                method: "DELETE",
                url: "../../API/Ghe_API/DeleteGheModel/" + id
            })
                .done(function (msg) {
                    alert("Đã thay đổi trạng thái ghế " + msg.tenGhe);
                    location.reload();
                });
        })
    </script>

    <script>
        $('input[data-sucess="create_ghe"]').click(function (e) {
            e.preventDefault();
            const post_url = $("#Create").attr("action");
            const request_method = $("#Create").attr("method");
            const form_data = $("#Create").serialize();
            $.ajax({
                url: post_url,
                type: request_method,
                data: form_data
            }).done(function (response) {
                if (response) {
                    modalIntify({
                        title: 'Thông báo',
                        messenge: 'Thêm ghế thành công'
                    });
                    $('#modal-tb').modal('show');
                    $('#modal-tb').click(function (e) {
                        if (e.target.closest('#modal-tb') || e.target.closest('xRemove')) {
                            location.reload();
                        }
                    });

                } else {
                    modalIntify({
                        title: 'Thông báo',
                        messenge: 'Thêm ghế thất bại'
                    });
                    $('#modal-tb').modal('show');
                }
            });
        });
    </script>


    <script>
        $('input[data-sucess="edit_ghe"]').click(function (e) {
            e.preventDefault();
            const post_url = $("#Edit").attr("action");
            const request_method = $("#Edit").attr("method");
            const form_data = $("#Edit").serialize();
            $.ajax({
                url: post_url,
                type: request_method,
                data: form_data
            }).done(function (response) {
                if (response) {
                    modalIntify({
                        title: 'Thông báo',
                        messenge: 'Sửa ghế thành công'
                    });
                    $('#modal-tb').modal('show');
                    $('#modal-tb').click(function (e) {
                        if (e.target.closest('#modal-tb') || e.target.closest('xRemove')) {
                            location.reload();
                        }
                    });

                } else {
                    modalIntify({
                        title: 'Thông báo',
                        messenge: 'Sửa ghế thất bại'
                    });
                    $('#modal-tb').modal('show');
                }
            });
        });
    </script>
    <script>
        function modalIntify({ title, messenge }) {
            const modalTitle = document.getElementById('modal-tb-title');
            const modalBody = document.getElementById('modal-tb-body');
            modalTitle.textContent = title;
            modalTitle.style.fontSize = '20px';
            modalTitle.style.textAlign = 'center';
            modalTitle.style.fontWeight = '400';
            modalBody.textContent = messenge;
            modalBody.style.textAlign = 'center';
        }
    </script>
}
